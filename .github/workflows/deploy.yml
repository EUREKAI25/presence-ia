name: Deploy to VPS

on:
  push:
    branches: [ main ]
  workflow_dispatch:  # Permet de déclencher manuellement depuis GitHub

jobs:
  deploy:
    runs-on: ubuntu-latest
    steps:
      - name: Deploy via SSH
        run: |
          sudo apt-get update && sudo apt-get install -y sshpass
          sshpass -p '${{ secrets.VPS_PASSWORD }}' ssh -o StrictHostKeyChecking=no root@212.227.80.241 << 'EOF'
            cd /opt/presence-ia
            git pull origin main
            systemctl restart presence-ia
            echo "✅ Déploiement réussi"
          EOF
        timeout-minutes: 5

      - name: Deployment success
        if: success()
        run: echo "✅ Déploiement réussi sur presence-ia.com"

      - name: Deployment failed
        if: failure()
        run: echo "❌ Échec du déploiement - vérifier SSH"
